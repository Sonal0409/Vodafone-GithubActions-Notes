
Clone the repository:

https://github.com/demo1orgtoday/MavenBuild-End-Project.git

Create 2 secrets on the repo for docker credentials:

     DOCKERHUB_USERNAME 
      DOCKERHUB_TOKEN 


Add the below workflow on github actions

name: CICD with End project
on:
 push:
  branches:
   - master
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout the code 
      uses: actions/checkout@v4
    - name: Install java and Maven
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'
        cache: 'maven'
    - name: Install docker 
      uses: docker/setup-buildx-action@v3
    - name: build the code
      run: mvn package
    - name: Login to dockerhub
      uses: docker/login-action@v3
      with:
          username: ${{ secrets.DOCKERHUB_USERNAME }}
          password: ${{ secrets.DOCKERHUB_TOKEN }}
    - name: Build Image and push to dockerhub 
      uses: docker/build-push-action@v6
      with: 
       context: .
       push: true 
       tags: ${{ secrets.DOCKERHUB_USERNAME }}/myprojectimage:latest


Step 2: Creating a reusable workflow
=================================
go to repo --> go to .github/workflows
Go to main.yml --> edit the file

Replace the on: section with this section:

on: workflow_call

The new workflow will be:

name: CICD with End project
on: workflow_call
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout the code 
      uses: actions/checkout@v4
    - name: Install java and Maven
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'
        cache: 'maven'
    - name: Install docker 
      uses: docker/setup-buildx-action@v3
    - name: build the code
      run: mvn package
    - name: Login to dockerhub
      uses: docker/login-action@v3
      with:
          username: ${{ secrets.DOCKERHUB_USERNAME }}
          password: ${{ secrets.DOCKERHUB_TOKEN }}
    - name: Build Image and push to dockerhub 
      uses: docker/build-push-action@v6
      with: 
       context: .
       push: true 
       tags: ${{ secrets.DOCKERHUB_USERNAME }}/myprojectimage:latest

Go to Actions dashboard--> click on New workflow button --> click on setup the workflwo yourself --> give a new name to the file as Reusable_workflow.yml
  and add below code

name: Call the CICD workflow
on: push
jobs:
  callCICD:
   uses: ./.github/workflows/main.yml
   secrets: inherit


Save the file


Step 3: Add cache depenedencies in the workflow:
=======================
go to .github/worflows/main.yml

Open the mian.yml

remove the previous code and add this come

name: CICD with End project
on: workflow_call
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout the code 
      uses: actions/checkout@v4
    - name: Install java and Maven
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'
        cache: 'maven'
    - name: Cache Maven Dependencies
      uses: actions/cache@v3
      with:
        path: ~/.m2
        key: ${{ runner.os }}-cache
    - name: Install docker 
      uses: docker/setup-buildx-action@v3
    - name: build the code
      run: mvn package
    - name: Login to dockerhub
      uses: docker/login-action@v3
      with:
          username: ${{ secrets.DOCKERHUB_USERNAME }}
          password: ${{ secrets.DOCKERHUB_TOKEN }}
    - name: Build Image and push to dockerhub 
      uses: docker/build-push-action@v6
      with: 
       context: .
       push: true 
       tags: ${{ secrets.DOCKERHUB_USERNAME }}/myprojectimage:latest


Commit the code -> check the workflow execution.








